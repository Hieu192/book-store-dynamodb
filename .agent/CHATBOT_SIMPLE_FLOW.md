# SÆ  Äá»’ LUá»’NG CHATBOT - PHIÃŠN Báº¢N ÄÆ N GIáº¢N

## ğŸ“± LUá»’NG HOáº T Äá»˜NG Tá»ª Äáº¦U Äáº¾N CUá»I

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          CHATBOT WORKFLOW - 12 BÆ¯á»šC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 1: USER Má» TRANG WEB                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ‘¤ User â†’ Click vÃ o icon chatbot trÃªn website                              â”‚
â”‚  ğŸ’» Frontend â†’ Äá»c JWT token tá»« localStorage                                â”‚
â”‚  ğŸ“¡ Frontend â†’ Táº¡o WebSocket:                                                â”‚
â”‚     wss://abc123.execute-api.ap-southeast-1.amazonaws.com/prod?token=JWT     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 2: API GATEWAY NHáº¬N REQUEST                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸŒ API Gateway WebSocket API                                                â”‚
â”‚     - Route: $connect                                                        â”‚
â”‚     - Region: ap-southeast-1                                                 â”‚
â”‚     - Protocol: WSS (WebSocket Secure)                                       â”‚
â”‚  ğŸ“‹ Event data:                                                              â”‚
â”‚     {                                                                        â”‚
â”‚       requestContext: {                                                      â”‚
â”‚         connectionId: "abc123xyz",                                           â”‚
â”‚         routeKey: "$connect"                                                 â”‚
â”‚       },                                                                     â”‚
â”‚       queryStringParameters: {                                               â”‚
â”‚         token: "eyJhbGc..."                                                  â”‚
â”‚       }                                                                      â”‚
â”‚     }                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 3: LAMBDA CONNECT - XÃC THá»°C                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ”§ Lambda: bookstore-chatbot-connect                                        â”‚
â”‚  ğŸ“¦ Runtime: Node.js 18.x                                                    â”‚
â”‚  ğŸ’¾ Memory: 256 MB                                                           â”‚
â”‚  â±ï¸  Timeout: 10 seconds                                                     â”‚
â”‚                                                                              â”‚
â”‚  âœ… Xá»­ lÃ½:                                                                   â”‚
â”‚  1. Láº¥y token tá»« query params                                               â”‚
â”‚  2. Äá»c JWT_SECRET tá»« AWS Secrets Manager                                   â”‚
â”‚  3. Verify token vá»›i jsonwebtoken.verify()                                  â”‚
â”‚  4. Decode Ä‘á»ƒ láº¥y userId, email                                             â”‚
â”‚  5. Náº¿u invalid â†’ Return 401 Unauthorized                                    â”‚
â”‚  6. Náº¿u valid â†’ Äi tiáº¿p bÆ°á»›c 4                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 4: LÆ¯U CONNECTION VÃ€O DYNAMODB                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ—„ï¸  DynamoDB Table: BookStore                                               â”‚
â”‚                                                                              â”‚
â”‚  Item Ä‘Æ°á»£c lÆ°u:                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    PK: "CONNECTION#abc123xyz",                                               â”‚
â”‚    SK: "USER#user-456",                                                      â”‚
â”‚    connectionId: "abc123xyz",                                                â”‚
â”‚    userId: "user-456",                                                       â”‚
â”‚    userEmail: "hieu@example.com",                                            â”‚
â”‚    connectedAt: "2025-12-09T13:45:00Z",                                      â”‚
â”‚    TTL: 1733851500  // Auto delete sau 24h                                   â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  âœ… Lambda return: { statusCode: 200, body: 'Connected' }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 5: FRONTEND NHáº¬N CONFIRMATION                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  âœ… WebSocket connection established                                         â”‚
â”‚  ğŸ’» Frontend hiá»ƒn thá»‹: "Chatbot Ä‘Ã£ sáºµn sÃ ng! ğŸ¤–"                             â”‚
â”‚  ğŸŸ¢ Status: Connected                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        USER Gá»¬I TIN NHáº®N Äáº¦U TIÃŠN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 6: USER Gá»¬I TIN NHáº®N                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ‘¤ User nháº­p: "Giá»›i thiá»‡u vá» sÃ¡ch Harry Potter?"                           â”‚
â”‚  ğŸ“¡ Frontend gá»­i qua WebSocket:                                              â”‚
â”‚     ws.send(JSON.stringify({                                                 â”‚
â”‚       type: "message",                                                       â”‚
â”‚       data: {                                                                â”‚
â”‚         message: "Giá»›i thiá»‡u vá» sÃ¡ch Harry Potter?",                         â”‚
â”‚         conversationId: "conv-1733851500",                                   â”‚
â”‚         useRAG: true                                                         â”‚
â”‚       }                                                                      â”‚
â”‚     }))                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 7: API GATEWAY ROUTE $DEFAULT                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸŒ API Gateway nháº­n message                                                 â”‚
â”‚  ğŸ¯ Route: $default â†’ Lambda: send-message                                   â”‚
â”‚  ğŸ“¦ Event data:                                                              â”‚
â”‚     {                                                                        â”‚
â”‚       requestContext: { connectionId: "abc123xyz" },                         â”‚
â”‚       body: "{\"type\":\"message\",\"data\":{...}}"                          â”‚
â”‚     }                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 8: LAMBDA SEND MESSAGE - Xá»¬ LÃ CHÃNH (QUAN TRá»ŒNG NHáº¤T!)               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ”§ Lambda: bookstore-chatbot-send-message                                   â”‚
â”‚  ğŸ’¾ Memory: 1024 MB (cáº§n nhiá»u RAM)                                          â”‚
â”‚  â±ï¸  Timeout: 30 seconds                                                     â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  8.1. Parse request body                                                 â”‚
â”‚      const body = JSON.parse(event.body);                                    â”‚
â”‚      const message = body.data.message;                                      â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  8.2. Láº¥y thÃ´ng tin user tá»« DynamoDB                                     â”‚
â”‚      Query: WHERE PK = "CONNECTION#abc123xyz"                                â”‚
â”‚      Result: userId = "user-456"                                             â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  8.3. Láº¥y lá»‹ch sá»­ chat (conversation history)                            â”‚
â”‚      Query: WHERE PK = "CONVERSATION#conv-xxx" AND SK begins_with "MSG#"     â”‚
â”‚      Result: [                                                               â”‚
â”‚        { userMsg: "SÃ¡ch nÃ o hay?", botReply: "Harry Potter..." },            â”‚
â”‚        { userMsg: "GiÃ¡ bao nhiÃªu?", botReply: "$20..." }                     â”‚
â”‚      ]                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 9: Gá»ŒI BEDROCK RAG - TRUY Váº¤N KNOWLEDGE BASE                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ§  AWS Bedrock Agent Runtime                                                â”‚
â”‚  ğŸ“š API: RetrieveAndGenerate                                                 â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  9.1. Convert cÃ¢u há»i thÃ nh embedding vector                             â”‚
â”‚      Model: amazon.titan-embed-text-v1                                       â”‚
â”‚      Input: "Giá»›i thiá»‡u vá» sÃ¡ch Harry Potter?"                               â”‚
â”‚      Output: [0.123, -0.456, 0.789, ..., 0.321] (1536 dimensions)            â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  9.2. Search trong OpenSearch Serverless                                 â”‚
â”‚      Query type: HYBRID (vector + keyword)                                   â”‚
â”‚      Top K: 5 documents                                                      â”‚
â”‚      Similarity: Cosine                                                      â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  9.3. Retrieve top documents:                                            â”‚
â”‚      ğŸ“„ Doc 1: s3://chatbot-kb/documents/harry-potter-intro.pdf              â”‚
â”‚         Score: 0.95                                                          â”‚
â”‚         Content: "Harry Potter lÃ  series 7 cuá»‘n sÃ¡ch fantasy..."             â”‚
â”‚                                                                              â”‚
â”‚      ğŸ“„ Doc 2: s3://chatbot-kb/documents/hp-reviews.txt                      â”‚
â”‚         Score: 0.89                                                          â”‚
â”‚         Content: "ÄÃ¡nh giÃ¡ 5 sao cho series..."                              â”‚
â”‚                                                                              â”‚
â”‚      ğŸ“„ Doc 3: s3://chatbot-kb/documents/bestseller-list.md                  â”‚
â”‚         Score: 0.75                                                          â”‚
â”‚         Content: "Top 10 sÃ¡ch bÃ¡n cháº¡y..."                                   â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  9.4. Augment prompt vá»›i context:                                        â”‚
â”‚      """                                                                     â”‚
â”‚      Báº¡n lÃ  trá»£ lÃ½ bookstore thÃ´ng minh.                                     â”‚
â”‚      Dá»±a vÃ o context sau:                                                    â”‚
â”‚      <context>                                                               â”‚
â”‚      [Doc 1 content]                                                         â”‚
â”‚      [Doc 2 content]                                                         â”‚
â”‚      [Doc 3 content]                                                         â”‚
â”‚      </context>                                                              â”‚
â”‚                                                                              â”‚
â”‚      Lá»‹ch sá»­ chat:                                                           â”‚
â”‚      User: SÃ¡ch nÃ o hay?                                                     â”‚
â”‚      Bot: Harry Potter ráº¥t hay!                                              â”‚
â”‚                                                                              â”‚
â”‚      CÃ¢u há»i má»›i: Giá»›i thiá»‡u vá» sÃ¡ch Harry Potter?                           â”‚
â”‚      Tráº£ lá»i ngáº¯n gá»n, thÃ¢n thiá»‡n báº±ng tiáº¿ng Viá»‡t.                           â”‚
â”‚      """                                                                     â”‚
â”‚                                                                              â”‚
â”‚  â–¶ï¸  9.5. Gá»i Foundation Model (Claude 3 Sonnet):                            â”‚
â”‚      Model: anthropic.claude-3-sonnet-20240229-v1:0                          â”‚
â”‚      Max tokens: 2000                                                        â”‚
â”‚      Temperature: 0.7                                                        â”‚
â”‚      Top P: 0.9                                                              â”‚
â”‚                                                                              â”‚
â”‚  âš¡ Processing time: ~8-15 seconds                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 10: BEDROCK TRáº¢ Vá»€ Káº¾T QUáº¢                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  âœ… Response tá»« Bedrock:                                                     â”‚
â”‚  {                                                                           â”‚
â”‚    output: {                                                                 â”‚
â”‚      text: "Harry Potter lÃ  series sÃ¡ch fantasy ná»•i tiáº¿ng tháº¿ giá»›i cá»§a      â”‚
â”‚             tÃ¡c giáº£ J.K. Rowling, gá»“m 7 cuá»‘n ká»ƒ vá» cáº­u bÃ© phÃ¹ thá»§y           â”‚
â”‚             Harry Potter vÃ  hÃ nh trÃ¬nh chá»‘ng láº¡i ChÃºa tá»ƒ Voldemort.          â”‚
â”‚             Series Ä‘Ã£ bÃ¡n Ä‘Æ°á»£c hÆ¡n 500 triá»‡u báº£n vÃ  Ä‘Æ°á»£c dá»‹ch ra             â”‚
â”‚             80 ngÃ´n ngá»¯. ÄÃ¢y lÃ  má»™t trong nhá»¯ng series sÃ¡ch bÃ¡n cháº¡y         â”‚
â”‚             nháº¥t má»i thá»i Ä‘áº¡i! ğŸ“šâœ¨"                                          â”‚
â”‚    },                                                                        â”‚
â”‚    citations: [                                                              â”‚
â”‚      {                                                                       â”‚
â”‚        retrievedReferences: [                                                â”‚
â”‚          {                                                                   â”‚
â”‚            content: {                                                        â”‚
â”‚              text: "Harry Potter lÃ  series 7 cuá»‘n sÃ¡ch fantasy..."           â”‚
â”‚            },                                                                â”‚
â”‚            location: {                                                       â”‚
â”‚              type: "S3",                                                     â”‚
â”‚              s3Location: {                                                   â”‚
â”‚                uri: "s3://chatbot-kb/documents/harry-potter-intro.pdf"       â”‚
â”‚              }                                                               â”‚
â”‚            },                                                                â”‚
â”‚            metadata: {                                                       â”‚
â”‚              category: "book-review",                                        â”‚
â”‚              uploadedAt: "2025-12-01"                                        â”‚
â”‚            }                                                                 â”‚
â”‚          }                                                                   â”‚
â”‚        ]                                                                     â”‚
â”‚      }                                                                       â”‚
â”‚    ],                                                                        â”‚
â”‚    guardrailAction: "NONE"  // KhÃ´ng vi pháº¡m guardrails                      â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ’° Cost: ~$0.003 input + $0.015 output = ~$0.018                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 11: LÆ¯U Lá»ŠCH Sá»¬ CHAT VÃ€O DYNAMODB                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ—„ï¸  Lambda save to DynamoDB:                                                â”‚
â”‚                                                                              â”‚
â”‚  Item 1 (User message):                                                      â”‚
â”‚  {                                                                           â”‚
â”‚    PK: "CONVERSATION#conv-1733851500",                                       â”‚
â”‚    SK: "MSG#2025-12-09T13:50:00Z#USER",                                      â”‚
â”‚    userId: "user-456",                                                       â”‚
â”‚    role: "user",                                                             â”‚
â”‚    message: "Giá»›i thiá»‡u vá» sÃ¡ch Harry Potter?",                              â”‚
â”‚    timestamp: "2025-12-09T13:50:00Z"                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Item 2 (Bot response):                                                      â”‚
â”‚  {                                                                           â”‚
â”‚    PK: "CONVERSATION#conv-1733851500",                                       â”‚
â”‚    SK: "MSG#2025-12-09T13:50:15Z#BOT",                                       â”‚
â”‚    userId: "user-456",                                                       â”‚
â”‚    role: "bot",                                                              â”‚
â”‚    message: "Harry Potter lÃ  series sÃ¡ch fantasy...",                        â”‚
â”‚    citations: [...],                                                         â”‚
â”‚    modelId: "claude-3-sonnet",                                               â”‚
â”‚    tokensUsed: 450,                                                          â”‚
â”‚    timestamp: "2025-12-09T13:50:15Z"                                         â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BÆ¯á»šC 12: Gá»¬I PHáº¢N Há»’I Vá»€ CLIENT                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ“¡ Lambda call API Gateway Management API:                                  â”‚
â”‚                                                                              â”‚
â”‚  POST https://abc123.execute-api.ap-southeast-1.amazonaws.com/prod/          â”‚
â”‚       @connections/abc123xyz                                                 â”‚
â”‚                                                                              â”‚
â”‚  Body:                                                                       â”‚
â”‚  {                                                                           â”‚
â”‚    type: "response",                                                         â”‚
â”‚    data: {                                                                   â”‚
â”‚      message: "Harry Potter lÃ  series sÃ¡ch fantasy...",                      â”‚
â”‚      citations: [                                                            â”‚
â”‚        {                                                                     â”‚
â”‚          source: "harry-potter-intro.pdf",                                   â”‚
â”‚          content: "Harry Potter lÃ  series 7 cuá»‘n..."                         â”‚
â”‚        }                                                                     â”‚
â”‚      ],                                                                      â”‚
â”‚      conversationId: "conv-1733851500",                                      â”‚
â”‚      timestamp: "2025-12-09T13:50:15Z"                                       â”‚
â”‚    }                                                                         â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  âœ… Status: 200 OK                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ FRONTEND NHáº¬N VÃ€ HIá»‚N THá»Š                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ’» WebSocket.onmessage triggered:                                           â”‚
â”‚                                                                              â”‚
â”‚  ws.onmessage = (event) => {                                                 â”‚
â”‚    const response = JSON.parse(event.data);                                  â”‚
â”‚    displayBotMessage(response.data.message);                                 â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  ğŸ¤– UI hiá»ƒn thá»‹:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Bot: Harry Potter lÃ  series sÃ¡ch fantasy       â”‚                         â”‚
â”‚  â”‚      ná»•i tiáº¿ng tháº¿ giá»›i cá»§a tÃ¡c giáº£ J.K.       â”‚                         â”‚
â”‚  â”‚      Rowling, gá»“m 7 cuá»‘n ká»ƒ vá» cáº­u bÃ© phÃ¹      â”‚                         â”‚
â”‚  â”‚      thá»§y Harry Potter...                      â”‚                         â”‚
â”‚  â”‚                                                â”‚                         â”‚
â”‚  â”‚ ğŸ“ Nguá»“n: harry-potter-intro.pdf               â”‚                         â”‚
â”‚  â”‚ ğŸ• 13:50:15                                    â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                              â”‚
â”‚  â±ï¸  Total time: ~10-15 giÃ¢y (tá»« khi gá»­i Ä‘áº¿n khi nháº­n)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           BONUS: UPLOAD TÃ€I LIá»†U Má»šI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN UPLOAD TÃ€I LIá»†U                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ğŸ‘¨â€ğŸ’¼ Admin â†’ Upload file "book-review-2024.pdf"                             â”‚
â”‚  ğŸ“¡ ws.send({ type: "uploadDocument", data: {...} })                         â”‚
â”‚                                                                              â”‚
â”‚  â†’ Lambda Upload Document triggered                                          â”‚
â”‚  â†’ Upload to S3: s3://chatbot-kb/documents/book-review-2024.pdf              â”‚
â”‚  â†’ Trigger Bedrock Ingestion Job                                             â”‚
â”‚  â†’ Bedrock:                                                                  â”‚
â”‚     1. Äá»c PDF                                                               â”‚
â”‚     2. Chia thÃ nh chunks (~500 tokens/chunk)                                 â”‚
â”‚     3. Convert má»—i chunk thÃ nh vector embedding                              â”‚
â”‚     4. LÆ°u vÃ o OpenSearch Serverless                                         â”‚
â”‚  â†’ Status: Document indexed successfully!                                    â”‚
â”‚  â†’ BÃ¢y giá» chatbot cÃ³ thá»ƒ tráº£ lá»i dá»±a trÃªn tÃ i liá»‡u má»›i nÃ y                  â”‚
â”‚                                                                              â”‚
â”‚  â±ï¸  Indexing time: ~2-5 phÃºt (tÃ¹y kÃ­ch thÆ°á»›c file)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            TÃ“M Táº®T LUá»’NG HOáº T Äá»˜NG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BÆ¯á»šC      â”‚      THÃ€NH PHáº¦N      â”‚   THá»œI GIAN      â”‚      COST           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1-2         â”‚ Frontend + API GW    â”‚ ~100ms           â”‚ $0.000001           â”‚
â”‚ 3-4         â”‚ Lambda Connect       â”‚ ~500ms           â”‚ $0.00002            â”‚
â”‚ 5           â”‚ WebSocket confirm    â”‚ ~50ms            â”‚ -                   â”‚
â”‚ 6-7         â”‚ Send message         â”‚ ~100ms           â”‚ $0.000001           â”‚
â”‚ 8           â”‚ Lambda processing    â”‚ ~200ms           â”‚ $0.00005            â”‚
â”‚ 9           â”‚ Bedrock RAG          â”‚ ~8-15s âš¡        â”‚ $0.015-0.030        â”‚
â”‚ 10          â”‚ Receive AI response  â”‚ ~100ms           â”‚ -                   â”‚
â”‚ 11          â”‚ Save to DynamoDB     â”‚ ~100ms           â”‚ $0.000003           â”‚
â”‚ 12          â”‚ Send to client       â”‚ ~150ms           â”‚ $0.000001           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ TOTAL                               â”‚ ~10-15 giÃ¢y      â”‚ $0.015-0.030/query  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         KIáº¾N TRÃšC TÃ€I NGUYÃŠN AWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š TÃ€I NGUYÃŠN CHÃNH:

1. ğŸŒ API Gateway WebSocket
   â”œâ”€ Endpoint: wss://xxx.execute-api.region.amazonaws.com/prod
   â”œâ”€ Routes: $connect, $disconnect, $default
   â”œâ”€ Throttling: 100 req/s, burst 500
   â””â”€ Cost: $1/million messages

2. ğŸ”§ Lambda Functions (4 functions)
   â”œâ”€ Connect (256MB, 10s)
   â”œâ”€ Disconnect (256MB, 10s)
   â”œâ”€ Send Message (1024MB, 30s) â­ MAIN
   â””â”€ Upload Document (512MB, 60s)

3. ğŸ—„ï¸ DynamoDB Table: BookStore
   â”œâ”€ Partition Key: PK
   â”œâ”€ Sort Key: SK
   â”œâ”€ GSI: GSI1PK-GSI1SK-index
   â”œâ”€ Billing: On-demand
   â””â”€ Patterns:
       â”œâ”€ CONNECTION#xxx â†’ User sessions
       â”œâ”€ CONVERSATION#xxx â†’ Chat history
       â””â”€ MSG#timestamp â†’ Individual messages

4. ğŸª£ S3 Bucket: chatbot-kb-{account-id}
   â”œâ”€ Versioning: Enabled
   â”œâ”€ Lifecycle: Delete old versions after 90 days
   â””â”€ Structure: documents/category/filename.pdf

5. ğŸ§  AWS Bedrock
   â”œâ”€ Knowledge Base: kb-xxx (manual setup)
   â”œâ”€ Foundation Model: Claude 3 Sonnet
   â”œâ”€ Embedding Model: Titan Embed v1
   â””â”€ API: RetrieveAndGenerate

6. ğŸ” OpenSearch Serverless
   â”œâ”€ Type: Vector engine
   â”œâ”€ Dimensions: 1536
   â”œâ”€ Similarity: Cosine
   â””â”€ OCU: 2 minimum (~$140/month)

7. ğŸ” AWS Secrets Manager
   â””â”€ Secret: bookstore/jwt-secret

8. ğŸ“Š CloudWatch Logs (4 log groups)
   â”œâ”€ /aws/lambda/bookstore-chatbot-connect (7 days)
   â”œâ”€ /aws/lambda/bookstore-chatbot-disconnect (7 days)
   â”œâ”€ /aws/lambda/bookstore-chatbot-send-message (14 days)
   â””â”€ /aws/lambda/bookstore-chatbot-upload-document (7 days)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              IAM PERMISSIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”‘ Lambda Execution Role: bookstore-chatbot-lambda-role

Policies:
âœ… AWSLambdaBasicExecutionRole (AWS managed)
   â†’ logs:CreateLogGroup, logs:CreateLogStream, logs:PutLogEvents

âœ… Custom Inline Policy:
   {
     "DynamoDB": [
       "dynamodb:GetItem",
       "dynamodb:PutItem",
       "dynamodb:UpdateItem",
       "dynamodb:DeleteItem",
       "dynamodb:Query",
       "dynamodb:Scan"
     ],
     "Bedrock": [
       "bedrock:InvokeModel",
       "bedrock:InvokeModelWithResponseStream",
       "bedrock:Retrieve",
       "bedrock:RetrieveAndGenerate"
     ],
     "S3": [
       "s3:GetObject",
       "s3:PutObject",
       "s3:ListBucket"
     ],
     "Secrets Manager": [
       "secretsmanager:GetSecretValue"
     ],
     "API Gateway": [
       "execute-api:ManageConnections"
     ]
   }


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           Äáº¶C ÄIá»‚M Ná»”I Báº¬T
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… SERVERLESS - KhÃ´ng cáº§n quáº£n lÃ½ server
âœ… AUTO-SCALING - Tá»± Ä‘á»™ng scale theo traffic
âœ… PAY-PER-USE - Chá»‰ tráº£ tiá»n khi dÃ¹ng
âœ… REAL-TIME - WebSocket cho chat trá»±c tiáº¿p
âœ… RAG AI - Tráº£ lá»i dá»±a trÃªn dá»¯ liá»‡u tháº­t
âœ… SECURE - JWT auth + IAM roles
âœ… MONITORED - CloudWatch logs Ä‘áº§y Ä‘á»§
âœ… VERSIONED - S3 versioning cho documents

âš ï¸ LIMITATIONS:
âŒ Lambda cold start (~1-2s láº§n Ä‘áº§u)
âŒ OpenSearch Serverless Ä‘áº¯t (~$140/month minimum)
âŒ Knowledge Base pháº£i táº¡o manual (khÃ´ng dÃ¹ng Terraform)
âŒ WebSocket timeout sau 2 giá» idle


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            CHI PHÃ Dá»° KIáº¾N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Giáº£ sá»­: 1000 users, má»—i user chat 10 messages/ngÃ y

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dá»‹ch vá»¥                  â”‚ Usage                        â”‚ Cost/month       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Gateway WebSocket    â”‚ 300K messages                â”‚ $1               â”‚
â”‚ Lambda invocations       â”‚ 600K invocations             â”‚ $5               â”‚
â”‚ DynamoDB                 â”‚ 1M read, 300K write          â”‚ $1               â”‚
â”‚ S3 storage               â”‚ 10 GB                        â”‚ $0.50            â”‚
â”‚ Bedrock Claude 3 Sonnet  â”‚ 15M input + 5M output tokens â”‚ $120             â”‚
â”‚ OpenSearch Serverless    â”‚ 2 OCU Ã— 730h                 â”‚ $140             â”‚
â”‚ CloudWatch Logs          â”‚ 5 GB ingested                â”‚ $2               â”‚
â”‚ Secrets Manager          â”‚ 1 secret                     â”‚ $0.50            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                                                   â”‚ ~$270/month      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ Äá»ƒ giáº£m chi phÃ­:
   - DÃ¹ng Claude 3 Haiku thay vÃ¬ Sonnet (ráº» hÆ¡n 10x)
   - Cache embeddings Ä‘á»ƒ giáº£m Bedrock calls
   - Compress documents trÆ°á»›c khi upload S3
   - Adjust OpenSearch OCU theo traffic thá»±c táº¿
